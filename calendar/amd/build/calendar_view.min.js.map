{"version":3,"sources":["../src/calendar_view.js"],"names":["define","$","Str","Notification","CalendarSelectors","CalendarEvents","CalendarViewManager","CalendarRepository","ModalFactory","ModalEventForm","ModalEvents","CalendarCrud","registerEventListeners","root","type","body","registerRemove","reloadFunction","charAt","toUpperCase","slice","on","created","deleted","updated","courseSelector","selectElement","courseId","val","find","elements","groupSelector","firstOption","children","first","empty","append","text","reloadGroupSelector","done","data","length","hide","addClass","show","removeClass","each","index","value","id","name","substring","appendTo","then","window","history","pushState","fail","exception","groupId","reloadCurrentMonth","filterChanged","e","daysWithEvent","eventType","hidden","eventFormPromise","registerEventFormModal","registerEditListeners","init"],"mappings":"AAsBAA,OAAM,+BAAC,CACC,QADD,CAEC,UAFD,CAGC,mBAHD,CAIC,yBAJD,CAKC,sBALD,CAMC,4BAND,CAOC,0BAPD,CAQC,oBARD,CASC,gCATD,CAUC,mBAVD,CAWC,oBAXD,CAAD,CAaF,SACIC,CADJ,CAEIC,CAFJ,CAGIC,CAHJ,CAIIC,CAJJ,CAKIC,CALJ,CAMIC,CANJ,CAOIC,CAPJ,CAQIC,CARJ,CASIC,CATJ,CAUIC,CAVJ,CAWIC,CAXJ,CAYE,CAEE,GAAIC,CAAAA,CAAsB,CAAG,SAASC,CAAT,CAAeC,CAAf,CAAqB,CAC9C,GAAIC,CAAAA,CAAI,CAAGd,CAAC,CAAC,MAAD,CAAZ,CAEAU,CAAY,CAACK,cAAb,CAA4BH,CAA5B,EAEA,GAAII,CAAAA,CAAc,CAAG,gBAAkBH,CAAI,CAACI,MAAL,CAAY,CAAZ,EAAeC,WAAf,EAAlB,CAAiDL,CAAI,CAACM,KAAL,CAAW,CAAX,CAAtE,CAEAL,CAAI,CAACM,EAAL,CAAQhB,CAAc,CAACiB,OAAvB,CAAgC,UAAW,CACvChB,CAAmB,CAACW,CAAD,CAAnB,CAAoCJ,CAApC,CACH,CAFD,EAGAE,CAAI,CAACM,EAAL,CAAQhB,CAAc,CAACkB,OAAvB,CAAgC,UAAW,CACvCjB,CAAmB,CAACW,CAAD,CAAnB,CAAoCJ,CAApC,CACH,CAFD,EAGAE,CAAI,CAACM,EAAL,CAAQhB,CAAc,CAACmB,OAAvB,CAAgC,UAAW,CACvClB,CAAmB,CAACW,CAAD,CAAnB,CAAoCJ,CAApC,CACH,CAFD,EAIAA,CAAI,CAACQ,EAAL,CAAQ,QAAR,CAAkBjB,CAAiB,CAACqB,cAApC,CAAoD,UAAW,IACvDC,CAAAA,CAAa,CAAGzB,CAAC,CAAC,IAAD,CADsC,CAEvD0B,CAAQ,CAAGD,CAAa,CAACE,GAAd,EAF4C,CAGvDH,CAAc,CAAGZ,CAAI,CAACgB,IAAL,CAAUzB,CAAiB,CAAC0B,QAAlB,CAA2BL,cAArC,CAHsC,CAKvDM,CAAa,CAAGlB,CAAI,CAACgB,IAAL,CAAUzB,CAAiB,CAAC0B,QAAlB,CAA2BC,aAArC,CALuC,CAMvDC,CAAW,CAAGD,CAAa,CAACE,QAAd,GAAyBC,KAAzB,EANyC,CAO3DH,CAAa,CAACI,KAAd,GACAJ,CAAa,CAACK,MAAd,CAAqB,mBAAoBJ,CAAW,CAACJ,GAAZ,EAApB,CAAwC,KAAxC,CAA+CI,CAAW,CAACK,IAAZ,EAA/C,CAAoE,WAAzF,EAEA,GAAe,CAAX,CAAAV,CAAJ,CAAkB,CACdrB,CAAmB,CAACgC,mBAApB,CAAwCX,CAAxC,EACKY,IADL,CACU,SAASC,CAAT,CAAe,CACjB,GAAoB,CAAhB,GAAAA,CAAI,CAACC,MAAT,CAAuB,CACnBV,CAAa,CAACW,IAAd,GACAjB,CAAc,CAACkB,QAAf,CAAwB,SAAxB,CACH,CAHD,IAGO,CACHZ,CAAa,CAACa,IAAd,GACAnB,CAAc,CAACoB,WAAf,CAA2B,SAA3B,EAEA5C,CAAC,CAAC6C,IAAF,CAAON,CAAP,CAAa,SAASO,CAAT,CAAgBC,CAAhB,CAAuB,CAChC/C,CAAC,CAAC,WAAD,CAAc,CACX+C,KAAK,CAAEA,CAAK,CAACC,EADF,CAEXZ,IAAI,CAAsB,EAApB,CAAAW,CAAK,CAACE,IAAN,CAAWT,MAAX,CAAyBO,CAAK,CAACE,IAAN,CAAWC,SAAX,CAAqB,CAArB,CAAwB,EAAxB,EAA8B,KAAvD,CAA+DH,CAAK,CAACE,IAFhE,CAAd,CAAD,CAGGE,QAHH,CAGYrB,CAHZ,CAIH,CALD,CAMH,CACJ,CAhBL,CAiBH,CAlBD,IAkBO,CACHA,CAAa,CAACW,IAAd,GACAjB,CAAc,CAACkB,QAAf,CAAwB,SAAxB,CACH,CAEDrC,CAAmB,CAACW,CAAD,CAAnB,CAAoCJ,CAApC,CAA0Cc,CAA1C,CAAoD,IAApD,EACK0B,IADL,CACU,UAAW,CAEb,MAAOxC,CAAAA,CAAI,CAACgB,IAAL,CAAUzB,CAAiB,CAACqB,cAA5B,EAA4CG,GAA5C,CAAgDD,CAAhD,CACV,CAJL,EAKK0B,IALL,CAKU,UAAW,CACbC,MAAM,CAACC,OAAP,CAAeC,SAAf,CAAyB,EAAzB,CAA6B,EAA7B,CAAiC,yBAA2B7B,CAA5D,CAGH,CATL,EAUK8B,IAVL,CAUUtD,CAAY,CAACuD,SAVvB,CAWH,CA5CD,EA8CA7C,CAAI,CAACQ,EAAL,CAAQ,QAAR,CAAkBjB,CAAiB,CAAC0B,QAAlB,CAA2BC,aAA7C,CAA4D,UAAW,IAC/DL,CAAAA,CAAa,CAAGzB,CAAC,CAAC,IAAD,CAD8C,CAE/D0D,CAAO,CAAGjC,CAAa,CAACE,GAAd,EAFqD,CAG/DD,CAAQ,CAAGd,CAAI,CAACgB,IAAL,CAAUzB,CAAiB,CAAC0B,QAAlB,CAA2BL,cAArC,EAAqDG,GAArD,EAHoD,CAKnEtB,CAAmB,CAACsD,kBAApB,CAAuC/C,CAAvC,CAA6Cc,CAA7C,CAAuD,IAAvD,EACK0B,IADL,CACU,UAAW,CAEb,MAAOxC,CAAAA,CAAI,CAACgB,IAAL,CAAUzB,CAAiB,CAAC0B,QAAlB,CAA2BC,aAArC,EAAoDH,GAApD,CAAwD+B,CAAxD,CACV,CAJL,EAKKF,IALL,CAKUtD,CAAY,CAACuD,SALvB,CAMH,CAXD,EAaA3C,CAAI,CAACM,EAAL,CAAQhB,CAAc,CAACwD,aAAvB,CAAsC,SAASC,CAAT,CAAYtB,CAAZ,CAAkB,CACpD,GAAIuB,CAAAA,CAAa,CAAGlD,CAAI,CAACgB,IAAL,CAAUzB,CAAiB,CAAC4D,SAAlB,CAA4BxB,CAAI,CAAC1B,IAAjC,CAAV,CAApB,CACA,GAAI,IAAA0B,CAAI,CAACyB,MAAT,CAAyB,CACrBF,CAAa,CAACpB,QAAd,CAAuB,QAAvB,CACH,CAFD,IAEO,CACHoB,CAAa,CAAClB,WAAd,CAA0B,QAA1B,CACH,CACJ,CAPD,EASA,GAAIqB,CAAAA,CAAgB,CAAGvD,CAAY,CAACwD,sBAAb,CAAoCtD,CAApC,CAAvB,CACAF,CAAY,CAACyD,qBAAb,CAAmCvD,CAAnC,CAAyCqD,CAAzC,CACH,CAvFD,CAyFA,MAAO,CACHG,IAAI,CAAE,cAASxD,CAAT,CAAeC,CAAf,CAAqB,CACvBD,CAAI,CAAGZ,CAAC,CAACY,CAAD,CAAR,CACAP,CAAmB,CAAC+D,IAApB,CAAyBxD,CAAzB,CAA+BC,CAA/B,EACAF,CAAsB,CAACC,CAAD,CAAOC,CAAP,CACzB,CALE,CAOV,CA3HC,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module is responsible for handle calendar day and upcoming view.\n *\n * @module     core_calendar/calendar\n * @copyright  2017 Simey Lameze <simey@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n        'jquery',\n        'core/str',\n        'core/notification',\n        'core_calendar/selectors',\n        'core_calendar/events',\n        'core_calendar/view_manager',\n        'core_calendar/repository',\n        'core/modal_factory',\n        'core_calendar/modal_event_form',\n        'core/modal_events',\n        'core_calendar/crud'\n    ],\n    function(\n        $,\n        Str,\n        Notification,\n        CalendarSelectors,\n        CalendarEvents,\n        CalendarViewManager,\n        CalendarRepository,\n        ModalFactory,\n        ModalEventForm,\n        ModalEvents,\n        CalendarCrud\n    ) {\n\n        var registerEventListeners = function(root, type) {\n            var body = $('body');\n\n            CalendarCrud.registerRemove(root);\n\n            var reloadFunction = 'reloadCurrent' + type.charAt(0).toUpperCase() + type.slice(1);\n\n            body.on(CalendarEvents.created, function() {\n                CalendarViewManager[reloadFunction](root);\n            });\n            body.on(CalendarEvents.deleted, function() {\n                CalendarViewManager[reloadFunction](root);\n            });\n            body.on(CalendarEvents.updated, function() {\n                CalendarViewManager[reloadFunction](root);\n            });\n\n            root.on('change', CalendarSelectors.courseSelector, function() {\n                var selectElement = $(this);\n                var courseId = selectElement.val();\n                var courseSelector = root.find(CalendarSelectors.elements.courseSelector);\n\n                var groupSelector = root.find(CalendarSelectors.elements.groupSelector);\n                var firstOption = groupSelector.children().first();\n                groupSelector.empty();\n                groupSelector.append('<option value=\"' + firstOption.val() + '\">' + firstOption.text() + '</option>');\n\n                if (courseId > 1) {\n                    CalendarViewManager.reloadGroupSelector(courseId)\n                        .done(function(data) {\n                            if (data.length === 0) {\n                                groupSelector.hide();\n                                courseSelector.addClass('mr-auto');\n                            } else {\n                                groupSelector.show();\n                                courseSelector.removeClass('mr-auto');\n\n                                $.each(data, function(index, value) {\n                                    $(\"<option/>\", {\n                                        value: value.id,\n                                        text: value.name.length > 15 ? value.name.substring(0, 14) + '...' : value.name\n                                    }).appendTo(groupSelector);\n                                });\n                            }\n                        });\n                } else {\n                    groupSelector.hide();\n                    courseSelector.addClass('mr-auto');\n                }\n\n                CalendarViewManager[reloadFunction](root, courseId, null)\n                    .then(function() {\n                        // We need to get the selector again because the content has changed.\n                        return root.find(CalendarSelectors.courseSelector).val(courseId);\n                    })\n                    .then(function() {\n                        window.history.pushState({}, '', '?view=upcoming&course=' + courseId);\n\n                        return;\n                    })\n                    .fail(Notification.exception);\n            });\n\n            root.on('change', CalendarSelectors.elements.groupSelector, function() {\n                var selectElement = $(this);\n                var groupId = selectElement.val();\n                var courseId = root.find(CalendarSelectors.elements.courseSelector).val();\n\n                CalendarViewManager.reloadCurrentMonth(root, courseId, null)\n                    .then(function() {\n                        // We need to get the group selector again because the content has changed.\n                        return root.find(CalendarSelectors.elements.groupSelector).val(groupId);\n                    })\n                    .fail(Notification.exception);\n            });\n\n            body.on(CalendarEvents.filterChanged, function(e, data) {\n                var daysWithEvent = root.find(CalendarSelectors.eventType[data.type]);\n                if (data.hidden == true) {\n                    daysWithEvent.addClass('hidden');\n                } else {\n                    daysWithEvent.removeClass('hidden');\n                }\n            });\n\n            var eventFormPromise = CalendarCrud.registerEventFormModal(root);\n            CalendarCrud.registerEditListeners(root, eventFormPromise);\n        };\n\n        return {\n            init: function(root, type) {\n                root = $(root);\n                CalendarViewManager.init(root, type);\n                registerEventListeners(root, type);\n            }\n        };\n    });\n"],"file":"calendar_view.min.js"}
{"version":3,"sources":["../src/calendar_view.js"],"names":["define","$","Str","Notification","CalendarSelectors","CalendarEvents","CalendarViewManager","CalendarRepository","ModalFactory","ModalEventForm","ModalEvents","CalendarCrud","registerEventListeners","root","type","body","registerRemove","reloadFunction","charAt","toUpperCase","slice","on","created","find","groupSelector","val","deleted","updated","courseSelector","selectElement","courseId","elements","firstOption","children","first","empty","append","text","reloadGroupSelector","done","data","length","hide","addClass","show","removeClass","each","index","value","id","name","substring","appendTo","then","window","history","pushState","fail","exception","groupId","parseInt","groupEvents","eventType","group","nogroupsElement","eventCount","remove","eventElement","eventlistElement","nogroupeventsElement","get_string","filterChanged","e","daysWithEvent","hidden","eventFormPromise","registerEventFormModal","registerEditListeners","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module is responsible for handling calendar day and upcoming view.\n *\n * @module     core_calendar/calendar\n * @copyright  2017 Simey Lameze <simey@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n        'jquery',\n        'core/str',\n        'core/notification',\n        'core_calendar/selectors',\n        'core_calendar/events',\n        'core_calendar/view_manager',\n        'core_calendar/repository',\n        'core/modal_factory',\n        'core_calendar/modal_event_form',\n        'core/modal_events',\n        'core_calendar/crud'\n    ],\n    function(\n        $,\n        Str,\n        Notification,\n        CalendarSelectors,\n        CalendarEvents,\n        CalendarViewManager,\n        CalendarRepository,\n        ModalFactory,\n        ModalEventForm,\n        ModalEvents,\n        CalendarCrud\n    ) {\n\n        var registerEventListeners = function(root, type) {\n            var body = $('body');\n\n            CalendarCrud.registerRemove(root);\n\n            var reloadFunction = 'reloadCurrent' + type.charAt(0).toUpperCase() + type.slice(1);\n\n            body.on(CalendarEvents.created, function() {\n                CalendarViewManager[reloadFunction](root);\n                root.find(CalendarSelectors.groupSelector).val(0);\n            });\n            body.on(CalendarEvents.deleted, function() {\n                CalendarViewManager[reloadFunction](root);\n                root.find(CalendarSelectors.groupSelector).val(0);\n            });\n            body.on(CalendarEvents.updated, function() {\n                CalendarViewManager[reloadFunction](root);\n                root.find(CalendarSelectors.groupSelector).val(0);\n            });\n\n            root.on('change', CalendarSelectors.courseSelector, function() {\n                var selectElement = $(this);\n                var courseId = selectElement.val();\n                var courseSelector = root.find(CalendarSelectors.elements.courseSelector);\n\n                var groupSelector = root.find(CalendarSelectors.elements.groupSelector);\n                var firstOption = groupSelector.children().first();\n                groupSelector.empty();\n                groupSelector.append('<option value=\"' + firstOption.val() + '\">' + firstOption.text() + '</option>');\n\n                if (courseId > 1) {\n                    CalendarViewManager.reloadGroupSelector(courseId)\n                        .done(function(data) {\n                            if (data.length === 0) {\n                                $('#coursegroupslabel').hide();\n                                groupSelector.hide();\n                                courseSelector.addClass('mr-auto');\n                            } else {\n                                $('#coursegroupslabel').show();\n                                groupSelector.show();\n                                courseSelector.removeClass('mr-auto');\n\n                                $.each(data, function(index, value) {\n                                    $(\"<option/>\", {\n                                        value: value.id,\n                                        text: value.name.length > 15 ? value.name.substring(0, 14) + '...' : value.name\n                                    }).appendTo(groupSelector);\n                                });\n                            }\n                        });\n                } else {\n                    groupSelector.hide();\n                    courseSelector.addClass('mr-auto');\n                }\n\n                CalendarViewManager[reloadFunction](root, courseId, null)\n                    .then(function() {\n                        // We need to get the selector again because the content has changed.\n                        return root.find(CalendarSelectors.courseSelector).val(courseId);\n                    })\n                    .then(function() {\n                        window.history.pushState({}, '', '?view=upcoming&course=' + courseId);\n\n                        return;\n                    })\n                    .fail(Notification.exception);\n            });\n\n            root.on('change', CalendarSelectors.elements.groupSelector, function() {\n                var groupId = parseInt($(this).val());\n                var groupEvents = root.find(CalendarSelectors.eventType.group);\n                var nogroupsElement = $('#nogroups');\n                var eventCount = 0;\n\n                if (nogroupsElement.length > 0) {\n                    nogroupsElement.remove();\n                }\n\n                if (groupEvents.length > 0) {\n                    $.each(groupEvents, function(index, value) {\n                        let eventElement = $(value);\n\n                        if (groupId === 0 || eventElement.data('event-groupid') === groupId) {\n                            eventElement.show();\n                            eventCount++;\n                        } else {\n                            eventElement.hide();\n                        }\n                    });\n\n                    if (eventCount === 0) {\n                        var eventlistElement = $(\".eventlist\");\n                        var nogroupeventsElement = $('<span id=\"nogroups\" class=\"calendar-information calendar-no-results\"></span>')\n                            .appendTo(eventlistElement);\n\n                        Str.get_string('nogroupevents', 'core_calendar')\n                            .done(function(data) {\n                                nogroupeventsElement.text(data);\n                            });\n                    }\n                }\n            });\n\n            body.on(CalendarEvents.filterChanged, function(e, data) {\n                var daysWithEvent = root.find(CalendarSelectors.eventType[data.type]);\n                if (data.hidden == true) {\n                    daysWithEvent.addClass('hidden');\n                } else {\n                    daysWithEvent.removeClass('hidden');\n                }\n            });\n\n            var eventFormPromise = CalendarCrud.registerEventFormModal(root);\n            CalendarCrud.registerEditListeners(root, eventFormPromise);\n        };\n\n        return {\n            init: function(root, type) {\n                root = $(root);\n                CalendarViewManager.init(root, type);\n                registerEventListeners(root, type);\n            }\n        };\n    });\n"],"file":"calendar_view.min.js"}
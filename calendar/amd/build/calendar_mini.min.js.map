{"version":3,"sources":["../src/calendar_mini.js"],"names":["define","$","Str","CalendarSelectors","CalendarEvents","CalendarViewManager","registerCalendarEventListeners","root","body","namespace","attr","on","created","reloadMonth","deleted","updated","eventMoved","e","data","is","reloadCurrentMonth","find","groupSelector","val","off","registerEventListeners","filterChanged","daysWithEvent","eventType","type","toggleClass","hidden","elements","courseSelector","selectElement","courseId","firstOption","children","first","empty","append","text","reloadGroupSelector","done","length","hide","addClass","show","removeClass","each","index","value","id","name","substring","appendTo","groupId","parseInt","groupEvents","group","nogroupsElement","eventCount","remove","eventElement","eventlistElement","nogroupeventsElement","get_string","init","loadOnInit"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module is the highest level module for the calendar. It is\n * responsible for initialising all of the components required for\n * the calendar to run. It also coordinates the interaction between\n * components by listening for and responding to different events\n * triggered within the calendar UI.\n *\n * @module     core_calendar/calendar_mini\n * @copyright  2017 Andrew Nicols <andrew@nicols.co.uk>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/str',\n    'core_calendar/selectors',\n    'core_calendar/events',\n    'core_calendar/view_manager',\n],\nfunction(\n    $,\n    Str,\n    CalendarSelectors,\n    CalendarEvents,\n    CalendarViewManager\n) {\n\n    /**\n     * Listen to and handle any calendar events fired by the calendar UI.\n     *\n     * @method registerCalendarEventListeners\n     * @param {object} root The calendar root element\n     */\n    var registerCalendarEventListeners = function(root) {\n        var body = $('body');\n        var namespace = '.' + root.attr('id');\n\n        body.on(CalendarEvents.created + namespace, root, reloadMonth);\n        body.on(CalendarEvents.deleted + namespace, root, reloadMonth);\n        body.on(CalendarEvents.updated + namespace, root, reloadMonth);\n        body.on(CalendarEvents.eventMoved + namespace, root, reloadMonth);\n    };\n\n    /**\n     * Reload the month view in this month.\n     *\n     * @param {EventFacade} e\n     */\n    var reloadMonth = function(e) {\n        var root = e.data;\n        var body = $('body');\n        var namespace = '.' + root.attr('id');\n\n        if (root.is(':visible')) {\n            CalendarViewManager.reloadCurrentMonth(root);\n            root.find(CalendarSelectors.groupSelector).val(0);\n        } else {\n            // The root has been removed.\n            // Remove all events in the namespace.\n            body.off(CalendarEvents.created + namespace);\n            body.off(CalendarEvents.deleted + namespace);\n            body.off(CalendarEvents.updated + namespace);\n            body.off(CalendarEvents.eventMoved + namespace);\n        }\n    };\n\n    var registerEventListeners = function(root) {\n        $('body').on(CalendarEvents.filterChanged, function(e, data) {\n            var daysWithEvent = root.find(CalendarSelectors.eventType[data.type]);\n\n            daysWithEvent.toggleClass('calendar_event_' + data.type, !data.hidden);\n        });\n\n        var namespace = '.' + root.attr('id');\n        $('body').on('change' + namespace, CalendarSelectors.elements.courseSelector, function() {\n            if (root.is(':visible')) {\n                var selectElement = $(this);\n                var courseId = selectElement.val();\n                var categoryId = null;\n                var courseSelector = root.find(CalendarSelectors.elements.courseSelector);\n\n                var groupSelector = root.find(CalendarSelectors.elements.groupSelector);\n                var firstOption = groupSelector.children().first();\n                groupSelector.empty();\n                groupSelector.append('<option value=\"' + firstOption.val() + '\">' + firstOption.text() + '</option>');\n\n                if (courseId > 1) {\n                    CalendarViewManager.reloadGroupSelector(courseId)\n                        .done(function(data) {\n                            if (data.length === 0) {\n                                $('#coursegroupslabel').hide();\n                                groupSelector.hide();\n                                courseSelector.addClass('mr-auto');\n                            } else {\n                                $('#coursegroupslabel').show();\n                                groupSelector.show();\n                                courseSelector.removeClass('mr-auto');\n\n                                $.each(data, function(index, value) {\n                                    $(\"<option/>\", {\n                                        value: value.id,\n                                        text: value.name.length > 15 ? value.name.substring(0, 14) + '...' : value.name\n                                    }).appendTo(groupSelector);\n                                });\n                            }\n                        });\n                } else {\n                    groupSelector.hide();\n                    courseSelector.addClass('mr-auto');\n                }\n\n                CalendarViewManager.reloadCurrentMonth(root, courseId, categoryId);\n            } else {\n                $('body').off('change' + namespace);\n            }\n        });\n\n        root.on('change', CalendarSelectors.elements.groupSelector, function() {\n            var groupId = parseInt($(this).val());\n            var groupEvents = root.find(CalendarSelectors.eventType.group);\n            var nogroupsElement = $('#nogroups');\n            var eventCount = 0;\n\n            if (nogroupsElement.length > 0) {\n                nogroupsElement.remove();\n            }\n\n            if (groupEvents.length > 0) {\n                $.each(groupEvents, function (index, value) {\n                    let eventElement = $(value);\n\n                    if (groupId === 0 || eventElement.data('event-groupid') === groupId) {\n                        eventElement.show();\n                        eventCount++;\n                    } else {\n                        eventElement.hide();\n                    }\n                });\n\n                if (eventCount === 0) {\n                    var eventlistElement = $(\".eventlist\");\n                    var nogroupeventsElement = $('<span id=\"nogroups\" class=\"calendar-information calendar-no-results\"></span>')\n                        .appendTo(eventlistElement);\n\n                    Str.get_string('nogroupevents', 'core_calendar')\n                        .done(function (data) {\n                            nogroupeventsElement.text(data);\n                        });\n                }\n            }\n        });\n    };\n\n    return {\n        init: function(root, loadOnInit) {\n            root = $(root);\n            CalendarViewManager.init(root);\n            registerEventListeners(root);\n            registerCalendarEventListeners(root);\n\n            if (loadOnInit) {\n                // The calendar hasn't yet loaded it's events so we\n                // should load them as soon as we've initialised.\n                CalendarViewManager.reloadCurrentMonth(root);\n            }\n\n        }\n    };\n});\n"],"file":"calendar_mini.min.js"}
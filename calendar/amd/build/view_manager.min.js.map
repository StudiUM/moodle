{"version":3,"sources":["../src/view_manager.js"],"names":["foldDayEvents","root","CalendarSelectors","elements","monthDetailed","days","find","day","length","each","dayContainer","eventsSelector","dateContent","filteredEventsSelector","moreEventsSelector","events","filteredEvents","numberOfFiltered","numberOfEvents","count","event","isNotFiltered","attr","offset","hide","show","moreEventsLink","then","str","link","text","fail","registerEventListenersForMonthDetailed","pendingId","CalendarEvents","viewUpdated","on","e","filterChanged","data","pending","Pending","target","eventType","type","transitionPromise","$","Deferred","hidden","promise","always","resolve","registerEventListeners","links","eventLink","eventId","pendingPromise","matches","actions","viewEvent","closest","dataset","querySelector","preventDefault","stopPropagation","renderEventSummaryModal","catch","navLink","wrapper","view","courseId","categoryId","currentTarget","groupSelector","val","changeMonth","href","year","month","changeDay","viewSelector","CustomEvents","define","activate","option","classList","contains","courseid","categoryid","refreshMonthContent","updateUrl","Notification","exception","refreshDayContent","reloadCurrentUpcoming","template","startLoading","M","util","js_pending","get","join","includenavigation","mini","viewMode","CalendarRepository","getCalendarMonthData","context","Templates","render","html","js","replaceNode","document","dispatchEvent","CustomEvent","js_complete","stopLoading","url","args","trigger","monthChanged","reloadCurrentMonth","courseChanged","getCalendarDayData","viewingday","showviewselector","reloadCurrentDay","dayChanged","viewingFullCalendar","getElementById","fullCalendarView","window","history","pushState","loadingIconContainer","containers","loadingIcon","removeClass","addClass","getCalendarUpcomingData","viewingupcoming","getEventTypeClassFromType","getEventById","getEventResponse","Error","eventData","modalParams","title","name","SummaryModal","TYPE","body","templateContext","canedit","candelete","headerclasses","normalisedeventtype","isactionevent","action","ModalFactory","create","modal","getRoot","ModalEvents","destroy","reloadGroupSelector","getCourseGroupsData","init","calendarTable","id"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A javascript module to handler calendar view changes.\n *\n * @module     core_calendar/view_manager\n * @copyright  2017 Andrew Nicols <andrew@nicols.co.uk>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport * as CalendarRepository from 'core_calendar/repository';\nimport CalendarEvents from 'core_calendar/events';\nimport * as CalendarSelectors from 'core_calendar/selectors';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport SummaryModal from 'core_calendar/summary_modal';\nimport CustomEvents from 'core/custom_interaction_events';\nimport {get_string as getString} from 'core/str';\nimport Pending from 'core/pending';\nimport {prefetchStrings} from 'core/prefetch';\n\n/**\n * Limit number of events per day\n *\n */\nconst LIMIT_DAY_EVENTS = 5;\n\n/**\n * Hide day events if more than 5.\n *\n */\nexport const foldDayEvents = () => {\n    const root = $(CalendarSelectors.elements.monthDetailed);\n    const days = root.find(CalendarSelectors.day);\n    if (days.length === 0) {\n        return;\n    }\n    days.each(function() {\n        const dayContainer = $(this);\n        const eventsSelector = `${CalendarSelectors.elements.dateContent} ul li[data-event-eventtype]`;\n        const filteredEventsSelector = `${CalendarSelectors.elements.dateContent} ul li[data-event-filtered=\"true\"]`;\n        const moreEventsSelector = `${CalendarSelectors.elements.dateContent} [data-action=\"view-more-events\"]`;\n        const events = dayContainer.find(eventsSelector);\n        if (events.length === 0) {\n            return;\n        }\n\n        const filteredEvents = dayContainer.find(filteredEventsSelector);\n        const numberOfFiltered = filteredEvents.length;\n        const numberOfEvents = events.length - numberOfFiltered;\n\n        let count = 1;\n        events.each(function() {\n            const event = $(this);\n            const isNotFiltered = event.attr('data-event-filtered') !== 'true';\n            const offset = (numberOfEvents === LIMIT_DAY_EVENTS) ? 0 : 1;\n            if (isNotFiltered) {\n                if (count > LIMIT_DAY_EVENTS - offset) {\n                    event.attr('data-event-folded', 'true');\n                    event.hide();\n                } else {\n                    event.attr('data-event-folded', 'false');\n                    event.show();\n                    count++;\n                }\n            } else {\n                // It's being filtered out.\n                event.attr('data-event-folded', 'false');\n            }\n        });\n\n        const moreEventsLink = dayContainer.find(moreEventsSelector);\n        if (numberOfEvents > LIMIT_DAY_EVENTS) {\n            const numberOfHiddenEvents = numberOfEvents - LIMIT_DAY_EVENTS + 1;\n            moreEventsLink.show();\n            getString('moreevents', 'calendar', numberOfHiddenEvents).then(str => {\n                const link = moreEventsLink.find('strong a');\n                moreEventsLink.attr('data-event-folded', 'false');\n                link.text(str);\n                return str;\n            }).fail();\n        } else {\n            moreEventsLink.hide();\n        }\n    });\n};\n\n/**\n * Register and handle month calendar events.\n *\n * @param {string} pendingId pending id.\n */\nexport const registerEventListenersForMonthDetailed = (pendingId) => {\n    const events = `${CalendarEvents.viewUpdated}`;\n    $('body').on(events, function(e) {\n        foldDayEvents(e);\n    });\n    foldDayEvents();\n    $('body').on(CalendarEvents.filterChanged, function(e, data) {\n        const root = $(CalendarSelectors.elements.monthDetailed);\n        const pending = new Pending(pendingId);\n        const target = root.find(CalendarSelectors.eventType[data.type]);\n        const transitionPromise = $.Deferred();\n        if (data.hidden) {\n            transitionPromise.then(function() {\n                target.attr('data-event-filtered', 'true');\n                return target.hide().promise();\n            }).fail();\n        } else {\n            transitionPromise.then(function() {\n                target.attr('data-event-filtered', 'false');\n                return target.show().promise();\n            }).fail();\n        }\n\n        transitionPromise.then(function() {\n            foldDayEvents();\n            return;\n        })\n        .always(pending.resolve)\n        .fail();\n\n        transitionPromise.resolve();\n    });\n};\n\n/**\n * Register event listeners for the module.\n *\n * @param {object} root The root element.\n */\nconst registerEventListeners = (root) => {\n    root = $(root);\n\n    // Bind click events to event links.\n    root.on('click', CalendarSelectors.links.eventLink, (e) => {\n        const target = e.target;\n        let eventLink = null;\n        let eventId = null;\n        const pendingPromise = new Pending('core_calendar/view_manager:eventLink:click');\n\n        if (target.matches(CalendarSelectors.actions.viewEvent)) {\n            eventLink = target;\n        } else {\n            eventLink = target.closest(CalendarSelectors.actions.viewEvent);\n        }\n\n        if (eventLink) {\n            eventId = eventLink.dataset.eventId;\n        } else {\n            eventId = target.querySelector(CalendarSelectors.actions.viewEvent).dataset.eventId;\n        }\n\n        if (eventId) {\n            // A link was found. Show the modal.\n\n            e.preventDefault();\n            // We've handled the event so stop it from bubbling\n            // and causing the day click handler to fire.\n            e.stopPropagation();\n\n            renderEventSummaryModal(eventId)\n            .then(pendingPromise.resolve)\n            .catch();\n        } else {\n            pendingPromise.resolve();\n        }\n    });\n\n    root.on('click', CalendarSelectors.links.navLink, (e) => {\n        const wrapper = root.find(CalendarSelectors.wrapper);\n        const view = wrapper.data('view');\n        const courseId = wrapper.data('courseid');\n        const categoryId = wrapper.data('categoryid');\n        const link = e.currentTarget;\n\n        if (view === 'month' || view === 'monthblock') {\n            root.find(CalendarSelectors.groupSelector).val(0);\n            changeMonth(root, link.href, link.dataset.year, link.dataset.month, courseId, categoryId, link.dataset.day);\n            e.preventDefault();\n        } else if (view === 'day') {\n            root.find(CalendarSelectors.groupSelector).val(0);\n            changeDay(root, link.href, link.dataset.year, link.dataset.month, link.dataset.day, courseId, categoryId);\n            e.preventDefault();\n        }\n    });\n\n    const viewSelector = root.find(CalendarSelectors.viewSelector);\n    CustomEvents.define(viewSelector, [CustomEvents.events.activate]);\n    viewSelector.on(\n        CustomEvents.events.activate,\n        (e) => {\n            e.preventDefault();\n\n            const option = e.target;\n            if (option.classList.contains('active')) {\n                return;\n            }\n\n            const view = option.dataset.view,\n                year = option.dataset.year,\n                month = option.dataset.month,\n                day = option.dataset.day,\n                courseId = option.dataset.courseid,\n                categoryId = option.dataset.categoryid;\n\n            if (view == 'month') {\n                refreshMonthContent(root, year, month, courseId, categoryId, root, 'core_calendar/calendar_month', day)\n                    .then(() => {\n                        updateUrl('?view=month');\n                    }).fail(Notification.exception);\n            } else if (view == 'day') {\n                refreshDayContent(root, year, month, day, courseId, categoryId, root, 'core_calendar/calendar_day')\n                    .then(() => {\n                        updateUrl('?view=day');\n                    }).fail(Notification.exception);\n            } else if (view == 'upcoming') {\n                reloadCurrentUpcoming(root, courseId, categoryId, root, 'core_calendar/calendar_upcoming')\n                    .then(() => {\n                        updateUrl('?view=upcoming');\n                    }).fail(Notification.exception);\n            }\n        }\n    );\n};\n\n/**\n * Refresh the month content.\n *\n * @param {object} root The root element.\n * @param {number} year Year\n * @param {number} month Month\n * @param {number} courseId The id of the course whose events are shown\n * @param {number} categoryId The id of the category whose events are shown\n * @param {object} target The element being replaced. If not specified, the calendarwrapper is used.\n * @param {string} template The template to be rendered.\n * @param {number} day Day (optional)\n * @return {promise}\n */\nexport const refreshMonthContent = (root, year, month, courseId, categoryId, target = null, template = '', day = 1) => {\n    startLoading(root);\n\n    target = target || root.find(CalendarSelectors.wrapper);\n    template = template || root.attr('data-template');\n    M.util.js_pending([root.get('id'), year, month, courseId].join('-'));\n    const includenavigation = root.data('includenavigation');\n    const mini = root.data('mini');\n    const viewMode = target.data('view');\n    return CalendarRepository.getCalendarMonthData(year, month, courseId, categoryId, includenavigation, mini, day, viewMode)\n        .then(context => {\n            return Templates.render(template, context);\n        })\n        .then((html, js) => {\n            return Templates.replaceNode(target, html, js);\n        })\n        .then(() => {\n            document.querySelector('body').dispatchEvent(new CustomEvent(CalendarEvents.viewUpdated));\n            return;\n        })\n        .always(() => {\n            M.util.js_complete([root.get('id'), year, month, courseId].join('-'));\n            return stopLoading(root);\n        })\n        .fail(Notification.exception);\n};\n\n/**\n * Handle changes to the current calendar view.\n *\n * @param {object} root The container element\n * @param {string} url The calendar url to be shown\n * @param {number} year Year\n * @param {number} month Month\n * @param {number} courseId The id of the course whose events are shown\n * @param {number} categoryId The id of the category whose events are shown\n * @param {number} day Day (optional)\n * @return {promise}\n */\nexport const changeMonth = (root, url, year, month, courseId, categoryId, day = 1) => {\n    return refreshMonthContent(root, year, month, courseId, categoryId, null, '', day)\n        .then((...args) => {\n            if (url.length && url !== '#') {\n                updateUrl(url);\n            }\n            return args;\n        })\n        .then((...args) => {\n            $('body').trigger(CalendarEvents.monthChanged, [year, month, courseId, categoryId]);\n            return args;\n        });\n};\n\n/**\n * Reload the current month view data.\n *\n * @param {object} root The container element.\n * @param {number} courseId The course id.\n * @param {number} categoryId The id of the category whose events are shown\n * @return {promise}\n */\nexport const reloadCurrentMonth = (root, courseId = 0, categoryId = 0) => {\n    const year = root.find(CalendarSelectors.wrapper).data('year');\n    const month = root.find(CalendarSelectors.wrapper).data('month');\n    const day = root.find(CalendarSelectors.wrapper).data('day');\n\n    courseId = courseId || root.find(CalendarSelectors.wrapper).data('courseid');\n    categoryId = categoryId || root.find(CalendarSelectors.wrapper).data('categoryid');\n\n    return refreshMonthContent(root, year, month, courseId, categoryId, null, '', day).\n        then((...args) => {\n            $('body').trigger(CalendarEvents.courseChanged, [year, month, courseId, categoryId]);\n            return args;\n        });\n};\n\n\n/**\n * Refresh the day content.\n *\n * @param {object} root The root element.\n * @param {number} year Year\n * @param {number} month Month\n * @param {number} day Day\n * @param {number} courseId The id of the course whose events are shown\n * @param {number} categoryId The id of the category whose events are shown\n * @param {object} target The element being replaced. If not specified, the calendarwrapper is used.\n * @param {string} template The template to be rendered.\n *\n * @return {promise}\n */\nexport const refreshDayContent = (root, year, month, day, courseId, categoryId, target = null, template = '') => {\n    startLoading(root);\n\n    if (!target || target.length == 0){\n        target = root.find(CalendarSelectors.wrapper);\n    }\n    template = template || root.attr('data-template');\n    M.util.js_pending([root.get('id'), year, month, day, courseId, categoryId].join('-'));\n    const includenavigation = root.data('includenavigation');\n    return CalendarRepository.getCalendarDayData(year, month, day, courseId, categoryId, includenavigation)\n        .then((context) => {\n            context.viewingday = true;\n            context.showviewselector = true;\n            return Templates.render(template, context);\n        })\n        .then((html, js) => {\n            return Templates.replaceNode(target, html, js);\n        })\n        .then(() => {\n            document.querySelector('body').dispatchEvent(new CustomEvent(CalendarEvents.viewUpdated));\n            return;\n        })\n        .always(() => {\n            M.util.js_complete([root.get('id'), year, month, day, courseId, categoryId].join('-'));\n            return stopLoading(root);\n        })\n        .fail(Notification.exception);\n};\n\n/**\n * Reload the current day view data.\n *\n * @param {object} root The container element.\n * @param {number} courseId The course id.\n * @param {number} categoryId The id of the category whose events are shown\n * @return {promise}\n */\nexport const reloadCurrentDay = (root, courseId = 0, categoryId = 0) => {\n    const wrapper = root.find(CalendarSelectors.wrapper);\n    const year = wrapper.data('year');\n    const month = wrapper.data('month');\n    const day = wrapper.data('day');\n\n    courseId = courseId || root.find(CalendarSelectors.wrapper).data('courseid');\n    categoryId = categoryId || root.find(CalendarSelectors.wrapper).data('categoryid');\n\n    return refreshDayContent(root, year, month, day, courseId, categoryId);\n};\n\n/**\n * Handle changes to the current calendar view.\n *\n * @param {object} root The root element.\n * @param {String} url The calendar url to be shown\n * @param {Number} year Year\n * @param {Number} month Month\n * @param {Number} day Day\n * @param {Number} courseId The id of the course whose events are shown\n * @param {Number} categoryId The id of the category whose events are shown\n * @return {promise}\n */\nexport const changeDay = (root, url, year, month, day, courseId, categoryId) => {\n    return refreshDayContent(root, year, month, day, courseId, categoryId)\n        .then((...args) => {\n            if (url.length && url !== '#') {\n                updateUrl(url);\n            }\n            return args;\n        })\n        .then((...args) => {\n            $('body').trigger(CalendarEvents.dayChanged, [year, month, courseId, categoryId]);\n            return args;\n        });\n};\n\n/**\n * Update calendar URL.\n *\n * @param {String} url The calendar url to be updated.\n */\nexport const updateUrl = (url) => {\n    const viewingFullCalendar = document.getElementById(CalendarSelectors.fullCalendarView);\n\n    // We want to update the url only if the user is viewing the full calendar.\n    if (viewingFullCalendar) {\n        window.history.pushState({}, '', url);\n    }\n};\n\n/**\n * Set the element state to loading.\n *\n * @param {object} root The container element\n * @method startLoading\n */\nconst startLoading = (root) => {\n    const loadingIconContainer = root.find(CalendarSelectors.containers.loadingIcon);\n\n    loadingIconContainer.removeClass('hidden');\n};\n\n/**\n * Remove the loading state from the element.\n *\n * @param {object} root The container element\n * @method stopLoading\n */\nconst stopLoading = (root) => {\n    const loadingIconContainer = root.find(CalendarSelectors.containers.loadingIcon);\n\n    loadingIconContainer.addClass('hidden');\n};\n\n/**\n * Reload the current month view data.\n *\n * @param {object} root The container element.\n * @param {number} courseId The course id.\n * @param {number} categoryId The id of the category whose events are shown\n * @param {object} target The element being replaced. If not specified, the calendarwrapper is used.\n * @param {string} template The template to be rendered.\n * @return {promise}\n */\nexport const reloadCurrentUpcoming = (root, courseId = 0, categoryId = 0, target = null, template = '') => {\n    startLoading(root);\n\n    target = target || root.find(CalendarSelectors.wrapper);\n    template = template || root.attr('data-template');\n    courseId = courseId || root.find(CalendarSelectors.wrapper).data('courseid');\n    categoryId = categoryId || root.find(CalendarSelectors.wrapper).data('categoryid');\n\n    return CalendarRepository.getCalendarUpcomingData(courseId, categoryId)\n        .then((context) => {\n            context.viewingupcoming = true;\n            context.showviewselector = true;\n            return Templates.render(template, context);\n        })\n        .then((html, js) => {\n            return Templates.replaceNode(target, html, js);\n        })\n        .then(() => {\n            document.querySelector('body').dispatchEvent(new CustomEvent(CalendarEvents.viewUpdated));\n            return;\n        })\n        .always(function() {\n            return stopLoading(root);\n        })\n        .fail(Notification.exception);\n};\n\n/**\n * Get the CSS class to apply for the given event type.\n *\n * @param {string} eventType The calendar event type\n * @return {string}\n */\nconst getEventTypeClassFromType = (eventType) => {\n    return 'calendar_event_' + eventType;\n};\n\n/**\n * Render the event summary modal.\n *\n * @param {Number} eventId The calendar event id.\n * @returns {Promise}\n */\nconst renderEventSummaryModal = (eventId) => {\n    const pendingPromise = new Pending('core_calendar/view_manager:renderEventSummaryModal');\n\n    // Calendar repository promise.\n    return CalendarRepository.getEventById(eventId)\n    .then((getEventResponse) => {\n        if (!getEventResponse.event) {\n            throw new Error('Error encountered while trying to fetch calendar event with ID: ' + eventId);\n        }\n\n        return getEventResponse.event;\n    })\n    .then(eventData => {\n        // Build the modal parameters from the event data.\n        const modalParams = {\n            title: eventData.name,\n            type: SummaryModal.TYPE,\n            body: Templates.render('core_calendar/event_summary_body', eventData),\n            templateContext: {\n                canedit: eventData.canedit,\n                candelete: eventData.candelete,\n                headerclasses: getEventTypeClassFromType(eventData.normalisedeventtype),\n                isactionevent: eventData.isactionevent,\n                url: eventData.url,\n                action: eventData.action\n            }\n        };\n\n        // Create the modal.\n        return ModalFactory.create(modalParams);\n    })\n    .then(modal => {\n        // Handle hidden event.\n        modal.getRoot().on(ModalEvents.hidden, function() {\n            // Destroy when hidden.\n            modal.destroy();\n        });\n\n        // Finally, render the modal!\n        modal.show();\n\n        return modal;\n    })\n    .then(modal => {\n        pendingPromise.resolve();\n\n        return modal;\n    })\n    .catch(Notification.exception);\n};\n\n/**\n * Reload the group selector when changing course.\n *\n * @param {number} courseId The course id.\n * @return {promise}\n */\nexport const reloadGroupSelector = (courseId = 0) => {\n    return CalendarRepository.getCourseGroupsData(courseId)\n        .fail(Notification.exception);\n};\n\nexport const init = (root, view) => {\n    prefetchStrings('calendar', ['moreevents']);\n    foldDayEvents();\n    registerEventListeners(root, view);\n    const calendarTable = root.find(CalendarSelectors.elements.monthDetailed);\n    if (calendarTable.length) {\n        const pendingId = `month-detailed-${calendarTable.id}-filterChanged`;\n        registerEventListenersForMonthDetailed(calendarTable, pendingId);\n    }\n};\n"],"file":"view_manager.min.js"}
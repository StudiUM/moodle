{"version":3,"sources":["../src/calendar.js"],"names":["define","$","Ajax","Str","Templates","Notification","CustomEvents","ModalEvents","ModalFactory","ModalEventForm","SummaryModal","CalendarRepository","CalendarEvents","CalendarViewManager","CalendarCrud","CalendarSelectors","Config","SELECTORS","ROOT","DAY","NEW_EVENT_BUTTON","DAY_CONTENT","LOADING_ICON","VIEW_DAY_LINK","CALENDAR_MONTH_WRAPPER","TODAY","DAY_NUMBER_CIRCLE","DAY_NUMBER","handleMoveEvent","e","eventId","originElement","destinationElement","originTimestamp","destinationTimestamp","attr","render","then","html","js","find","addClass","appendNodeContents","updateEventStartDay","trigger","eventMoved","always","destinationLoadingElement","removeClass","replaceNode","originLoadingElement","fail","exception","registerCalendarEventListeners","root","eventFormModalPromise","body","on","created","reloadCurrentMonth","groupSelector","val","deleted","updated","editActionEvent","url","window","location","assign","moveEvent","registerEditListeners","registerEventListeners","viewingFullCalendar","document","getElementById","fullCalendarView","dayLink","target","closest","year","data","month","day","courseId","categoryId","refreshDayContent","preventDefault","updateUrl","wwwroot","elements","courseSelector","selectElement","firstOption","children","first","empty","append","text","reloadGroupSelector","done","length","hide","show","each","index","value","id","name","substring","appendTo","groupId","parseInt","groupEvents","eventType","group","eventElement","parent","eventFormPromise","registerEventFormModal","contextId","displayingSmallBlockCalendar","parents","dateContainer","hasViewDayLink","startTime","modal","wrapper","setCourseId","setCategoryId","setContextId","setStartTime","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module is the highest level module for the calendar. It is\n * responsible for initialising all of the components required for\n * the calendar to run. It also coordinates the interaction between\n * components by listening for and responding to different events\n * triggered within the calendar UI.\n *\n * @module     core_calendar/calendar\n * @copyright  2017 Simey Lameze <simey@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n            'jquery',\n            'core/ajax',\n            'core/str',\n            'core/templates',\n            'core/notification',\n            'core/custom_interaction_events',\n            'core/modal_events',\n            'core/modal_factory',\n            'core_calendar/modal_event_form',\n            'core_calendar/summary_modal',\n            'core_calendar/repository',\n            'core_calendar/events',\n            'core_calendar/view_manager',\n            'core_calendar/crud',\n            'core_calendar/selectors',\n            'core/config',\n        ],\n        function(\n            $,\n            Ajax,\n            Str,\n            Templates,\n            Notification,\n            CustomEvents,\n            ModalEvents,\n            ModalFactory,\n            ModalEventForm,\n            SummaryModal,\n            CalendarRepository,\n            CalendarEvents,\n            CalendarViewManager,\n            CalendarCrud,\n            CalendarSelectors,\n            Config,\n        ) {\n\n    var SELECTORS = {\n        ROOT: \"[data-region='calendar']\",\n        DAY: \"[data-region='day']\",\n        NEW_EVENT_BUTTON: \"[data-action='new-event-button']\",\n        DAY_CONTENT: \"[data-region='day-content']\",\n        LOADING_ICON: '.loading-icon',\n        VIEW_DAY_LINK: \"[data-action='view-day-link']\",\n        CALENDAR_MONTH_WRAPPER: \".calendarwrapper\",\n        TODAY: '.today',\n        DAY_NUMBER_CIRCLE: '.day-number-circle',\n        DAY_NUMBER: '.day-number'\n    };\n\n    /**\n     * Handler for the drag and drop move event. Provides a loading indicator\n     * while the request is sent to the server to update the event start date.\n     *\n     * Triggers a eventMoved calendar javascript event if the event was successfully\n     * updated.\n     *\n     * @param {event} e The calendar move event\n     * @param {int} eventId The event id being moved\n     * @param {object|null} originElement The jQuery element for where the event is moving from\n     * @param {object} destinationElement The jQuery element for where the event is moving to\n     */\n    var handleMoveEvent = function(e, eventId, originElement, destinationElement) {\n        var originTimestamp = null;\n        var destinationTimestamp = destinationElement.attr('data-day-timestamp');\n\n        if (originElement) {\n            originTimestamp = originElement.attr('data-day-timestamp');\n        }\n\n        // If the event has actually changed day.\n        if (!originElement || originTimestamp != destinationTimestamp) {\n            Templates.render('core/loading', {})\n                .then(function(html, js) {\n                    // First we show some loading icons in each of the days being affected.\n                    destinationElement.find(SELECTORS.DAY_CONTENT).addClass('hidden');\n                    Templates.appendNodeContents(destinationElement, html, js);\n\n                    if (originElement) {\n                        originElement.find(SELECTORS.DAY_CONTENT).addClass('hidden');\n                        Templates.appendNodeContents(originElement, html, js);\n                    }\n                    return;\n                })\n                .then(function() {\n                    // Send a request to the server to make the change.\n                    return CalendarRepository.updateEventStartDay(eventId, destinationTimestamp);\n                })\n                .then(function() {\n                    // If the update was successful then broadcast an event letting the calendar\n                    // know that an event has been moved.\n                    $('body').trigger(CalendarEvents.eventMoved, [eventId, originElement, destinationElement]);\n                    return;\n                })\n                .always(function() {\n                    // Always remove the loading icons regardless of whether the update\n                    // request was successful or not.\n                    var destinationLoadingElement = destinationElement.find(SELECTORS.LOADING_ICON);\n                    destinationElement.find(SELECTORS.DAY_CONTENT).removeClass('hidden');\n                    Templates.replaceNode(destinationLoadingElement, '', '');\n\n                    if (originElement) {\n                        var originLoadingElement = originElement.find(SELECTORS.LOADING_ICON);\n                        originElement.find(SELECTORS.DAY_CONTENT).removeClass('hidden');\n                        Templates.replaceNode(originLoadingElement, '', '');\n                    }\n                    return;\n                })\n                .fail(Notification.exception);\n        }\n    };\n\n    /**\n     * Listen to and handle any calendar events fired by the calendar UI.\n     *\n     * @method registerCalendarEventListeners\n     * @param {object} root The calendar root element\n     * @param {object} eventFormModalPromise A promise reolved with the event form modal\n     */\n    var registerCalendarEventListeners = function(root, eventFormModalPromise) {\n        var body = $('body');\n\n        body.on(CalendarEvents.created, function() {\n            CalendarViewManager.reloadCurrentMonth(root);\n            root.find(CalendarSelectors.groupSelector).val(0);\n        });\n        body.on(CalendarEvents.deleted, function() {\n            CalendarViewManager.reloadCurrentMonth(root);\n            root.find(CalendarSelectors.groupSelector).val(0);\n        });\n        body.on(CalendarEvents.updated, function() {\n            CalendarViewManager.reloadCurrentMonth(root);\n            root.find(CalendarSelectors.groupSelector).val(0);\n        });\n        body.on(CalendarEvents.editActionEvent, function(e, url) {\n            // Action events needs to be edit directly on the course module.\n            window.location.assign(url);\n        });\n        // Handle the event fired by the drag and drop code.\n        body.on(CalendarEvents.moveEvent, handleMoveEvent);\n        // When an event is successfully moved we should updated the UI.\n        body.on(CalendarEvents.eventMoved, function() {\n            CalendarViewManager.reloadCurrentMonth(root);\n        });\n\n        CalendarCrud.registerEditListeners(root, eventFormModalPromise);\n    };\n\n    /**\n     * Register event listeners for the module.\n     *\n     * @param {object} root The calendar root element\n     */\n    var registerEventListeners = function(root) {\n        const viewingFullCalendar = document.getElementById(CalendarSelectors.fullCalendarView);\n        // Listen the click on the day link to render the day view.\n        root.on('click', SELECTORS.VIEW_DAY_LINK, function(e) {\n            var dayLink = $(e.target).closest(SELECTORS.VIEW_DAY_LINK);\n            var year = dayLink.data('year'),\n                month = dayLink.data('month'),\n                day = dayLink.data('day'),\n                courseId = dayLink.data('courseid'),\n                categoryId = dayLink.data('categoryid');\n            const url = '?view=day&time=' + dayLink.data('timestamp');\n            if (viewingFullCalendar) {\n                CalendarViewManager.refreshDayContent(root, year, month, day, courseId, categoryId, root,\n                    'core_calendar/calendar_day').then(function() {\n                    e.preventDefault();\n                    return CalendarViewManager.updateUrl(url);\n                }).fail(Notification.exception);\n            } else {\n                window.location.assign(Config.wwwroot + '/calendar/view.php' + url);\n            }\n        });\n\n        root.on('change', CalendarSelectors.elements.courseSelector, function() {\n            var selectElement = $(this);\n            var courseId = selectElement.val();\n            var courseSelector = root.find(CalendarSelectors.elements.courseSelector);\n\n            var groupSelector = root.find(CalendarSelectors.elements.groupSelector);\n            var firstOption = groupSelector.children().first();\n            groupSelector.empty();\n            groupSelector.append('<option value=\"' + firstOption.val() + '\">' + firstOption.text() + '</option>');\n\n            if (courseId > 1) {\n                CalendarViewManager.reloadGroupSelector(courseId)\n                    .done(function(data) {\n                        if (data.length === 0) {\n                            $('#coursegroupslabel').hide();\n                            groupSelector.hide();\n                            courseSelector.addClass('mr-auto');\n                        } else {\n                            $('#coursegroupslabel').show();\n                            groupSelector.show();\n                            courseSelector.removeClass('mr-auto');\n\n                            $.each(data, function(index, value) {\n                                $(\"<option/>\", {\n                                    value: value.id,\n                                    text: value.name.length > 15 ? value.name.substring(0, 14) + '...' : value.name\n                                }).appendTo(groupSelector);\n                            });\n                        }\n                    });\n            } else {\n                groupSelector.hide();\n                courseSelector.addClass('mr-auto');\n            }\n\n            CalendarViewManager.reloadCurrentMonth(root, courseId, null)\n                .then(function() {\n                    // We need to get the course selector again because the content has changed.\n                    return root.find(CalendarSelectors.elements.courseSelector).val(courseId);\n                })\n                .fail(Notification.exception);\n        });\n\n        root.on('change', CalendarSelectors.elements.groupSelector, function() {\n            var groupId = parseInt($(this).val());\n            var groupEvents = root.find(CalendarSelectors.eventType.group);\n\n            $.each(groupEvents.children(), function (index, value) {\n                let eventElement = $(value);\n\n                if (groupId === 0 || eventElement.data('event-groupid') === groupId) {\n                    eventElement.parent('li').show();\n                } else {\n                    eventElement.parent('li').hide();\n                }\n            });\n        });\n\n        var eventFormPromise = CalendarCrud.registerEventFormModal(root),\n            contextId = $(SELECTORS.CALENDAR_MONTH_WRAPPER).data('context-id');\n        registerCalendarEventListeners(root, eventFormPromise);\n\n        if (contextId) {\n            // Bind click events to calendar days.\n            root.on('click', SELECTORS.DAY, function(e) {\n                var target = $(e.target);\n                const displayingSmallBlockCalendar = root.parents('aside').data('blockregion') === 'side-pre';\n\n                if (!viewingFullCalendar && displayingSmallBlockCalendar) {\n                    const dateContainer = target.closest(SELECTORS.DAY);\n                    const url = '?view=day&time=' + dateContainer.data('day-timestamp');\n                    window.location.assign(Config.wwwroot + '/calendar/view.php' + url);\n                } else {\n                    const hasViewDayLink = target.closest(SELECTORS.VIEW_DAY_LINK).length;\n                    const shouldShowNewEventModal = !hasViewDayLink;\n                    if (shouldShowNewEventModal) {\n                        var startTime = $(this).attr('data-new-event-timestamp');\n                        eventFormPromise.then(function(modal) {\n                            var wrapper = target.closest(CalendarSelectors.wrapper);\n                            modal.setCourseId(wrapper.data('courseid'));\n\n                            var categoryId = wrapper.data('categoryid');\n                            if (typeof categoryId !== 'undefined') {\n                                modal.setCategoryId(categoryId);\n                            }\n\n                            modal.setContextId(wrapper.data('contextId'));\n                            modal.setStartTime(startTime);\n                            modal.show();\n                            return;\n                        }).fail(Notification.exception);\n                    }\n                }\n                e.preventDefault();\n            });\n        }\n    };\n\n    return {\n        init: function(root) {\n            root = $(root);\n            CalendarViewManager.init(root);\n            registerEventListeners(root);\n        }\n    };\n});\n"],"file":"calendar.min.js"}